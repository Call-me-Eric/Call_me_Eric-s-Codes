# NOIP模拟赛

 $\texttt{Larunatrecy}$

### 前言

- 感谢 $\texttt{HUNGRY123}$ 的验题。
- 下发文件中提供了一个较快的输入输出模板，以及一个使用样例，请注意是使用时需要在文件输入输出的情况下使用。

## T1.机械之心(heart)

### 题目背景

机械是冰冷的。

人心也是如此。

### 题目描述

小 $Y$ 拥有着机械之心。

小 $Y$ 拥有 $k$ 种不同的心脏，排列在一个 $n\times m$ 的网格中。

我们用 $c_{i,j}$ 代表第 $i$ 行第 $j$ 列的心脏的类型：

- 如果 $c_{i,j}=1$，代表这里不需要放置心脏。
- 如果 $c_{i,j}=0$，代表这里需要放置心脏。

小 $Y$ 认为，只有每种心脏在每一行，每一列都最多出现一次时，这种放置的方式才是优雅的。

小 $Y$ 想要你构造一种放置心脏的方案，使得符合 $c_{i,j}$ 的限制，且 $k$ 最小，同时输出方案。

### 输入格式 

本题有 $T$ 组测试数据。

第一行输入一个正整数 $T$ 代表测试组数。

对于每组测试数据，第一行两个正整数 $n,m$ 。

接下来 $n$ 行每行 $m$ 个数代表 $c_{i,j}$ 。

### 输出格式

对于每组数据，第一行一个正整数代表最小的 $k$ 。

接下来 $n$ 行 每行 $m$ 个数代表你放置的心脏的种类 $a_{i,j}$，你应当满足：

- 如果 $c_{i,j}=1$，那么 $a_{i,j}=0$ 
- 否则，任意一行，任意一列，$a>0$ 的位置的 $a$ 互不相同，且所有数位于 $[1,k]$ 之间。

如果有多组方案，你只需要输出任意一组即可。

### 输入样例

```cpp
2
2 2
0 0 
0 1 
2 2
1 0 
0 1 
```

### 输出样例

```cpp
2
2 1 
1 0 
1
0 1 
1 0 
```

### 数据规模与约定

对于 $10\%$ 的数据，$n,m\leq 3$

对于 $20\%$ 的数据，$n,m\leq 10$

对于 $40\%$ 的数据，$n,m\leq 50$

对于 $60\%$ 的数据，$n,m\leq 100$

对于另外 $10\%$ 的数据，$k=\max(n,m)$ 

对于另外 $10\%$ 的数据，$T=1$

对于 $100\%$ 的数据，$T\leq 10,1\leq n,m\leq 500$

## T2.同归世界(together)

### 题目背景

樱花飘落，桂树缄默。

在世界线相遇的那一天，我们还会在这里吗。

### 题目描述

小 $Y$ 珍藏着一个二元组构成的序列 $(a_i,b_i)$，并且他确信 $a_i$ 是一个 $n$ 的排列。

他记得，他曾经选择过一个区间 $[l,r]$ ，把这个区间内的二元组提取出来成一个新的二元组序列，然后他确定了对这个区间的喜爱程度。

他记得，他根据这个二元组序列建出了一棵树，这棵树满足如下三个性质：

- 是一棵有根二叉树，一共有 $r-l+1$ 个点。

- 对于非根节点 $x$，$a_x< a_{fa_x}$

- 中序遍历得到的二元组序列就是原序列。

可以证明这棵树是存在且唯一的。

对于节点 $x$，记 $w(x)$ 为 $x$ 在树上的祖先的 $b$ 之和。那么他对这个区间的喜爱程度就是所有节点的 $w(x)$ 之和。

小 $Y$ 不太记得他选择了什么区间，因此他需要你来帮他，他会给你两种询问：

- 给出 $l,r$ ，你需要求出他对区间 $[l,r]$ 的喜爱程度。
- 给出 $l,r$，你需要满足他对所有满足 $l\leq L\leq R\leq r$ 的区间 $[L,R]$ 的喜爱度之和。

### 输入格式

第一行两个正整数 $n,m$ 代表序列长度以及询问次数。

第二行一个长度为 $n$ 的排列 $a$ 。

第三行一个长度为 $n$ 的序列 $b$ 。

接下来 $m$ 行，每行三个正整数 $op,l,r$，如果$op=1$ 则代表第一种询问，如果 $op=2$ 则代表第二种询问。

### 输出格式

对于每个询问，如果答案为 $ans$，你需要输出 $(ans\times 114514)\bmod 2^{32}$ 的值。

### 输入样例

```cpp
5 5
1 5 2 4 3 
3 5 1 1 5 
1 1 3
2 2 4
2 2 4
2 1 3
2 1 2
```

### 输出样例

```cpp
2175766
4466046
4466046
5954728
2404794
```

### 数据规模

对于 $10\%$ 的数据，$n,m\leq 50$

对于 $20\%$ 的数据，$n,m\leq 500$

对于 $40\%$ 的数据，$n,m\leq 5000$

对于另外 $20\%$ 的数据，$op=1$

对于另外 $20\%$ 的数据，$n\times m\leq 5\times 10^7$

对于 $100\%$ 的数据，$1\leq n,m\leq 3\times 10^5,1\leq b_i\leq n,1\leq l\leq r\leq n$

## T3.积云四月(cumulonimbus)

### 题目背景

又到了四月了呢啊，转眼之间已经过去一年了。

小 $Y$ 已经没有心情数着天空的积雨云了，毕竟它们终会随风飘散了。

为什么呢，他总是想要回到三年前的那个四月啊……

### 题目描述

小 $Y$ 眼中的天空是一个 $n\times m$ 的平面，每个位置可能有一朵积雨云。

小 $Y$ 用一个 $n\times m$ 的 $01$ 矩阵 $Q$ 来表示积雨云的存在，$Q_{i,j}=1$ 代表位置 $(i,j)$ 有一朵积雨云，$Q_{i,j}=0$ 代表位置 $(i,j)$ 没有积雨云。

积雨云显然是会合并的。

小 $Y$ 认为积雨云 $A(x_1,y_1),B(x_2,y_2)$ 是可合并的，当且仅当 $x_1=x_2$ 或者 $y_1=y_2$ 。

当两朵积雨云合并之后，他们都会消散。

在一天天的观察中，小 $Y$ 发现，每一种初始的积雨云分布最终剩下的积雨云个数一定是所有可能的情况中最少的，这样才会使得积雨云变得稳定。

记 $C(Q)$ 为对于初始分布$Q$ ，最终变得稳定时的积雨云个数。

给定一个矩阵 $P_{i,j}$，$Q_{i,j}$ 有 $P_{i,j}$ 的概率为 $0$，$1-P_{i,j}$ 的概率为 $1$ 。

请你求出  $C(Q)$ 的期望在模 $p$ 意义下的值。

### 输入格式

本题有 $T$ 组测试数据。

第一行一个正整数 $T$ 。

对于每组数据，第一行三个数 $n,m,p$ 。

接着一个 $n\times m$ 的矩阵代表 $P$ 。

### 输出格式

对于每个数据，输出一个数字作为答案。

### 样例数据

#### 样例输入1

```cpp
1
2 2 998244353
1 1
1 1
```

### 样例输出1

```cpp
0
```

### 样例输入2

```cpp
1
2 2 998244353
499122177 499122177
499122177 499122177
```

### 样例输出2

```cpp
249561089
```

### 数据规模

- $10pts$ ，$T\leq 500,n\leq 3,m\leq 3$
- $20pts$，$T\leq 3,n\times m\leq 20$ 
- $10pts$，$T\leq 3,Q_{i,j}=0$ 或  $Q_{i,j}=1$ 。
- $20pts$，$T\leq 10,n\leq 5,m\leq 5$ 。
- $10pts$，$T\leq 50,n\leq 3$ 。
- $30pts$，$T\leq 3,n\leq 8,m\leq 8$ 。

对于 $100\%$ 的数据，$n\leq 8,m\leq 8,0\leq Q_{i,j}<p,10^5\leq p\leq 10^9,p$  是质数 。 

## T4.仲夏晚风(summer)

### 题目背景

那年夏天，是小 $Y$ 无法释怀的记忆。

站在微热的晚风之中，远望着。

只是逝去的不只有夕阳啊。

### 题目描述

小 $Y$ 在三年前种下了一棵有根树，根节点的编号为 $1$ 。

在一次次的晚风轻拂中，这棵树也不停地在生长。

这棵树有两种生长的方式，**「扎根」**和 **「长茎」** 。

- **「扎根」** 在树上的某个节点下方，生长了一个新的节点。
- **「长茎」** 在某一条边上，长出一个新的节点。

具体而言，一开始，树中只有 $1$ 号节点，记 $fa_x$ 为节点 $x$ 的父亲，$dis_{x,y}$ 为节点 $x,y$ 在树上的简单路径的边数。

有以下两种可能的事件发生：

- $\texttt{1 x,y}$  插入一个编号为 $x$ 的节点作为节点 $y$ 的儿子，即加入边 $(x,y)$。保证 $x$ 不在树中，$y$ 在树中。
- $\texttt{2 x,y}$  插入一个编号为 $x$ 的节点到节点 $y$ 和其父亲 $fa_y$ 的边中，也就是说，断掉边 $(y,fa_y)$，连上 $(x,fa_y),(y,x)$。保证 $x$ 不在树中，$y$ 在树中且不为根。

小 $Y$ 经常会在黄昏时分坐在这棵树下，吹着晚风。

他有的时候，会提出一些问题，也就是：

- $\texttt{3 l,r}$  记当前在树中的节点集合为 $T$ 。设 $f(u)=\sum\limits_{x\in T,x\in [l,r]} dis_{x,u}+dis_{u,1}$ ，小 $Y$ 想知道 $f(u)$ 最小的点的编号，特别的，如果  $T$ 与 $[l,r]$ 没有交集，小 $Y$ 认为编号为 $-1$ ；如果有多个最小的点，小 $Y$ 认为编号是距离 $1$ 节点最远的节点编号，如果还有多个，输出节点编号最大的。

你需要帮他解决上面的问题，同时对于部分数据点，你需要在线回答这些问题。

### 输入格式

本题强制在线。

第一行输入两个正整数  $n，T$ ，分别代表操作次数，加密参数。

接下里 $n$ 每行输入三个数 $op_i,a_i,b_i$，代表对应的的操作，其中 $a_i,b_i$ 需要进行解密，真实的操作参数 $a'_i=a_i\bigoplus(lastans\times T)，b'_i=b_i\bigoplus(lastans\times T)$，其中 $lastans$ 为上一次三操作的答案，初始时为 $0$ ，特别的如果上次询问的答案为 $-1$，$lastans=0$。

### 输出格式

对于每一个三操作，输出一个数代表答案。

### 输入样例

```cpp
5 0
1 3 1
2 4 3
3 3 5
1 2 1
3 2 4
```

### 输出样例

```
4
1
```

### 样例解释

一开始，树中只有节点 $1$。

一号操作后，树中有节点 $1,3$，边 $(1,3)$

二号操作后，树中有节点 $1,3,4$ ，边 $(1,4),(3,4)$ 。

三号操作时，区间 $[3,5]$ 中的节点有 $3,4$ ，$f(1)=3,f(4)=3,f(3)=5$ ，答案为 $4$ 。

### 数据规模

对于 $10\% $ 的数据  $n\leq 700$。

对于 $20\%$ 的数据，$n\leq 7000$ 。

对于 $35\%$ 的数据，$n\leq 5\times 10^4$ 

对于 $50\%$ 的数据，$n\leq 3\times 10^5$ 。

对于另外 $10\%$ 的数据，$T=0$ 

对于另外 $10\%$ 的数据，没有二操作。

对于另外 $10\%$ 的数据，保证树随机生成。

对于 $100\%$ 的数据，$1\leq n \leq 10^6，2\leq x\leq n+1,1\leq l\leq r\leq n+1$ 

