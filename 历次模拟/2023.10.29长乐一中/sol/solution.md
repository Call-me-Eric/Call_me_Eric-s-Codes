#

## 1

### A.进步科学

签到题。

显然是状压 DP。

考虑将每个点被人为拨动的影响直接计算到当前状态中，那么就要知道总共的时间有多长，于是枚举时间，直接 DP 即可。

### B.吉吉没急

先考虑满足最后没有学会毒瘤算法的人的限制。

设 $h_x$ 表示第 $x$ 个人学会毒瘤算法的时间至少为 $h_x+1$，若最后没有学会毒瘤算法，则为 $INF$。用  $$\text {dijkstra}$$  算法求解。

具体地，若 $R_i<=h_x$ 且 $L_i>h_y$，那么就要把 $h_y$更新为 $L_i$。

若 $h_1 \geq 0$，那么无解。

接下来考虑最后一定学会毒瘤算法的人的限制，显然，在满足$h_x$的条件下越早学会越好。

于是再跑一边带 $h_x$ 限制的最短路即可求出 $d_x$，若存在任意一个最后一定学会毒瘤算法的人 $d_x =INF$，则无解。

### C.老杰克哒

看到单点修改和区间查询立刻想到线段树，那么这题大概率是线段树维护 DP 了。

考虑我们如何将 $1$ 变成 $0$：如果是单个 $1$，$1$此操作即可；否则，要 $2$次操作。

于是就能设计 DP 状态了 : $f_{x,0/1}$ 表示考虑到第 $x$ 位，这一位上是 $0$ 或 $1$ 的最少步数。

转移显而易见，并且发现转移的形式是相同的，于是可以用矩阵乘法优化，这又正好符合线段树信息需要容易合并的性质。

### D.季积晓淆

考虑 $k = 1$ 怎么做，我们可以设 $f_i$ 表示 $i$ 到根的希望路程.

显然有
$$
f_u =
\begin{cases}
p_uf_u + \frac{1 - p_u}{d_u} \sum_{(u, v) \in E} f_v + 1 && u \neq 1 \\
0 && u = 1
\end{cases}
$$
也就是，除了 $1$ 号点，每个点都可以表示他与他儿子和父亲的一个方程.如果暴力高斯消元，时 $O(n ^ 3)$ 的，可以运用一些特出的技巧加速消元的过程.

首先对于一个叶子节点 $x$ ，存在一个只有 $f_x$ 和 $f_{fa_x}$ 的方程.

那么如果 $fa_x$ 为 $1$，那么可以计算出 $f_x$ ，否则在 $f_{fa_x}$ 的方程中消去 $f_x$.

将一个点的所有儿子都消去后，这一个点可以看作是叶子节点.

同理知道了父亲节点,我们可以倒推出所有的儿子节点.

那么 $k > 1$  怎么做呢？

考虑设 $f_{i, j}$ 代表 $i$ 到根的所有路径的 $j$ 次方的期望.

因为有二项式定理 $(x + 1) ^ k = \sum ^ k _ {j = 0} \binom{k}{j} x ^ j$

同理有
$$
f_{u, k} =
\begin{cases}
\sum_{j = 0} ^ {k} \binom{k}{j}(p_u f_{u, j} + \frac{1 - p_u}{d_u} \sum _ {(u, v) \in E} f_{v, j}) && u \neq 1 \\
0 && u = 1
\end{cases}
$$
注意到如果我们把 $f$ 按照 $j$ 分层，那么会发现贡献的矩阵是一个下三角的形式，那么对每一层 $O(n)$ 计算，然后暴力计算对更高层的贡献即可. 复杂度 $O(nk ^ 2)$

二项式定理的速度还是太慢了，考虑另外的一个等式
$$
x ^ k = \sum _ {j = 0} ^ k {k \brace j} \binom{x}{j} j!
$$
其中 ${k \brace j}$ 代表第二类斯特林数 $S(k, j)$.

这个等式意味着，只去要我们知道 $\binom{x}{j}(j = 0 \cdots k)$ 那么我们就可以还原出 $x ^ k$.

而这个组合是非常好维护的，有 $\binom {i}{j} = \binom{i - 1}{j} + \binom{i - 1}{j - 1}$.

于是设 $f_{u, j}$ 表示 $i$ 到根所有的路径长度（假设为 $t$）$\binom{t}{j}$ 的期望。可以 $O(nk)$ 转移.由于 $k \leq 10 ^ 5$，所以 $S(k,0 \cdots kb)$ 需要 $\text {FFT}$ 预处理，复杂度 $O(nk + k\log{k})$
