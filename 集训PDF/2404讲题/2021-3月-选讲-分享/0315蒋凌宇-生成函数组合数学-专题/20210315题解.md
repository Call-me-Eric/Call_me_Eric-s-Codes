#### AGC034F RNG and XOR

显然可以列出方程 $f_x=1+\sum_i p_if_{x\oplus i}$，$f_0=0$。

写成异或卷积的形式即
$$
(p_0,p_1,\ldots,p_{2^N-1})\cdot (f_0,f_1,\ldots,f_{2^N-1})=(y,f_1-1,\ldots,f_{2^N-1}-1)
$$
其中 $y$ 是未知数，因为 $f_0$ 并不满足方程。通过比较总和可以得到 $y=f_0+2^N-1$。

因此
$$
(p_0-1,p_1,\ldots,p_{2^N-1})\cdot (f_0,f_1,\ldots,f_{2^N-1})=(2^N-1,-1,\ldots,-1)
$$
进行 FWT，可以得到 $P_i\cdot F_i=X_i$，其中 $P_i$ 和 $X_i$ 都是常数。只要 $P_i$ 非零，就能直接解出 $F_i$。容易发现有且仅有 $P_0=X_0=0$，因此仅凭这些信息还不能确定 $F_0$。但我们还知道 $f_0=\frac{\sum_{i=0}^{2^N-1}F_i}{2^N}=0$，因此 $F_0=-\sum_{i=1}^{2^N-1}F_i$。最后进行逆变换即可得到答案。复杂度 $O(N2^N)$。

#### ARC089F ColoringBalls

先考虑判断一个序列是否合法。

首先将颜色相同的缩成一段，然后以 $\texttt W$ 作为分割点进行划分，则每一段都是独立的。

所有序列可以分成这些类：

1. $\{\texttt{R}\}$。

2. $\{\texttt{B},\texttt{BR},\texttt{RB},\texttt{RBR}\}$

3. $\{\texttt{BRB},\texttt{BRBR},\texttt{RBRB},\texttt{RBRBR}\}$

以此类推。

第一类对应的染色序列为 $\texttt{r}$，第二类为 $\texttt{rb}$，第 $n$ ($n\ge 3$) 类为 $\texttt{rb?}\ldots \texttt{?}$ (共 $n-2$ 个 $\texttt{?}$，$\texttt{?}$ 表示 $\texttt{r}$ 和 $\texttt{b}$ 都可以)。

因此我们只需要考虑每一段编号的可重集合 $S$，这样的集合数量并不很多，可以枚举。

考虑如何判断 $S$ 是否合法。先考虑每一组的 $\texttt{r}$，显然是选择前 $|S|$ 个 $\texttt{r}$，并且对应的段的编号是递减的。接着选择 $\texttt{b}$，显然也是从前往后为每组选择第一个可行的 $\texttt{b}$。最后再扫一遍检查每一组后面是否有足够多的字符可以匹配 $\texttt{?}$。

判断完之后，要计算方案数，显然可以用隔板法计算，并乘上 $S$ 的可重排列数。

#### ARC096E Everything on It

先容斥，转化为钦定 $i$ 个数出现不超过一次的方案数。

首先只包含其余 $n-i$ 个数的集合可以任意选。这 $i$ 个数中，首先一些数 (可以是 $0$ 个数) 不会选，剩下的数分成若干个集合，并加上其余 $n-i$ 个数的一个子集，因此上述的方案数为 $f_i=2^{2^{n-i}}\cdot \sum_{j=0}^{i}{i+1\brace j+1}\cdot (2^{n-i})^j$，因此答案即为 $\sum_{i=0}^n(-1)^i{n\choose i}f_i$。复杂度 $O(n^2)$。

#### CF1292F Nora's Toy Boxes

首先可以对每个弱连通块分别考虑。

反向考虑加点的过程，对于一个大小至少为 $2$ (不是孤立点) 的连通块，首先所有源点一定存在，并且至少需要一个非源点存在。因为图是传递的，即 $i\to j,j\to k$ 则 $i\to k$，因此只需要考虑源点和其他点之间的边。容易发现满足上述条件的初始状态都能最终加入所有点，否则能推出不连通。

考虑 DP，注意到我们只需要知道当前已经连了边的源点集合 $S$ 和已经加入的点数 $c$ 即可转移，即考虑加入点是否改变了 $S$：

- 如果改变了，即枚举 $v$ ($\mathrm{in}_v\not\subset S$ 且 $\mathrm{in}_v\cap S\ne \emptyset$，$\mathrm{in}_v$ 表示和 $v$ 之间有边的源点集合)，转移到 $(S\cup \mathrm{in}_v,c+1)$。
- 如果没有改变，则转移到 $(S,c+1)$，方案数为 $\mathrm{cnt}_S-c$，其中 $\mathrm{cnt}_S$ 表示 $\mathrm{in}_v\subset S$ 的点 $v$ 的个数，可以预处理。

假设源点个数为 $s$，则复杂度为 $O(n^22^s)$。由于数字都不超过 $60$，可以证明 $s\le 15$：首先 $31,32,\ldots ,60$ 不存在出边，因此不可能是源点。因此源点集合是 $\{1,2,\ldots,30\}$ 的一条反链，由 Dilworth 定理知其大小不超过任意一个链覆盖，因此给出一个大小为 $15$ 的链覆盖即可：第 $a$ 条链包含所有形如 $(2a-1)\cdot 2^k$ 的数。

总复杂度为 $O(n^22^{15})$。

#### CF1295F Good Contest

考虑所有的 $[l_i,r_i+1)$ 的区间端点，它们将值域划分成了 $O(n)$ 段，可以考虑从大到小每次转移一段。

设 $f(i,j)$ 表示考虑了最大的 $i$ 段，已经确定了序列的前 $j$ 个数的方案数。转移时枚举这一段填到 $k$ 为止，则要求 $j+1,j+2,\ldots,k$ 这些位置的可行区间都包含这一段，而填数的方案数是一个组合数。时间复杂度 $O(n^3)$。

#### GYM102512C Isolation

相当于不能经过区域边界上的 $O(D)$ 个点。显然可以容斥。即枚举 $p_1,p_2,\ldots,p_k$，其中 $p_i$ 是关键点，算出起点到 $p_1$ 再到 $p_2$ 一直到 $p_k$ 最后任意走的方案数，乘上 $(-1)^k$ 并求和。这个过程可以改成 DP，即 $f(i,j)$ 表示走了 $i$ 步走到第 $j$ 个关键点的带容斥系数的方案数之和，时间复杂度 $O(N^2D^2)$。

#### GYM102586E Count Modulo 2

所求即 $[x^S]\left(\sum_{i=1}^Kx^{A_i}\right)^N$。由于 $f(x)^2\equiv f(x^2)\mod 2$，因此可以转化为 $O(\log N)$ 个 $\sum_{i=1}^Kx^{2^kA_i}$ 的乘积。

考虑从低位到高位 DP，即 $f(i,v)$ 表示填了最低的 $i$ 位，当前的总和去掉最后 $i$ 位 (必然与 $S$ 相同) 的值为 $v$ 的方案数。设 $C=\max\{A_i\}$，注意到 $v\le C+C/2+C/4+\cdots\le 2C$ ，故总状态数为 $O(C\log N)$。转移时，首先枚举这一位选择的数，即与 $\sum_{i=1}^K x^{A_i}$ 做卷积，然后只保留最低位与 $S$ 的当前位相同的状态。由于我们只需要求模 $2$ 的答案，因此前一步可以用 bitset 优化，总复杂度 $O(CK\log N/w)$。

#### GYM102586I Amidakuji

先假设 $N$ 是奇数，容易发现 $p_i(x)=(x+2^{i-1}-1)\bmod N+1$ 满足要求，因为考虑 $p_i(x)$ 和 $p_i^{-1}(x)$ 的差，分别是 $2,2^2,\ldots,2^k$，取 $K=\lceil\log_2N\rceil$ 时能取遍不超过 $2N$ 的偶数，对 $N$ 取模后即可取遍所有数。

若 $N$ 是偶数，则上述做法能得到的数奇偶性是固定的，且 $K$ 取 $\lceil \log _2N\rceil-1$ 即可。$N=2$ 显然无解。否则可以考虑构造一个排列满足 $p(x)$ 和 $p^{-1}(x)$ 奇偶性不同。显然长度为 $4$ 形如 "奇奇偶偶" 的环满足要求，只需在两个排列 (当 $N\bmod 4=2$ 时一个排列显然不行) 中用上述的环覆盖所有元素即可。

#### HDU6691 Minimum Spanning Trees

设 $f(n,v,y)$ 表示 $n$ 个点由边权 $\le v$ 的边连通，最小生成树的边权和的生成函数 ($y$ 是形式变量，即设 $g(n,v,s)$ 为 $n$ 个点由边权 $\le v$ 的边连通且最小生成树边权和等于 $s$ 的概率，则 $f(n,v,y)=\sum_{s\ge 0}g(n,v,s)\cdot y^s$)。

则有以下等式
$$
\sum_{a_1+\cdots+a_m=n}\frac1{m!}{n\choose a_1,\ldots,a_m}\prod_{i}f(a_i,v-1,y)\prod_{i< j}((p_v+\cdots+p_k+p_0)\cdot y^v)^{a_ia_j}\\
=\sum_{a_1+\cdots+a_m=n}\frac1{m!}{n\choose a_1,\ldots,a_m}\prod_{i}f(a_i,v,y)\prod_{i< j}((p_{v+1}+\cdots+p_k+p_0)\cdot y^v)^{a_ia_j}
$$
左边是 $n$ 个点的随机图，将边权 $\ge v$ 的边 (包括不存在的边) 看成边权为 $v$ 后最小生成树权值和的生成函数，右边则只是将 $\ge v$ 改成了 $>v$，显然是相等的。

$y$ 这一维可以插值，因此现在 $f(n,v)$ 是一个数，将后面的 $\sum_{i< j}a_ia_j$ 展开成 ${n\choose 2}-\sum_{i}{a_i\choose 2}$ 之后就可以对 EGF 做 $\exp$ 和 $\ln$ 来计算了。

时间复杂度 $O(k^2n^3)$。